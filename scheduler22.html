<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="="width=device-width, initial-scale=1.0">
    <title>Weekly Schedule</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            margin: 0;
        }
        .video-container {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        .large-video {
            width: 60%; /* Reduced the width */
            background-color: black;
            height: 400px;
            border: 1px solid #ccc;
        }
        .messaging-container {
            width: 35%; /* Space left for the messaging area */
            display: flex;
            flex-direction: column;
            border: 1px solid #ccc;
            padding: 10px;
            box-sizing: border-box;
        }
        .message-box {
            flex: 1;
            background-color: #f9f9f9;
            overflow-y: auto;
            padding: 10px;
            border: 1px solid #ccc;
            margin-bottom: 10px;
            white-space: pre-wrap;
        }
        .message-input-container {
            display: flex;
            align-items: center;
        }
        .message-input {
            flex: 1;
            padding: 5px;
            margin-right: 10px;
            border: 1px solid #ccc;
            box-sizing: border-box;
        }
        .file-input {
            margin-right: 10px;
        }
        .send-button {
            padding: 5px 10px;
            cursor: pointer;
        }
        .small-video {
            width: 23%;
            background-color: black;
            height: 200px;
            border: 1px solid #ccc;
            margin-top: 10px;
        }
        .calendar-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .month-year-header {
            display: flex;
            align-items: center;
            cursor: pointer;
        }
        .month-year-header h2 {
            margin: 0;
            margin-right: 10px;
        }
        .arrow {
            font-size: 18px;
            cursor: pointer;
            user-select: none;
        }
        .week-calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            border: 1px solid #ccc;
            margin-bottom: 20px;
        }
        .day {
            border: 1px solid #ccc;
            display: flex;
            flex-direction: column;
            position: relative;
            padding-bottom: 10px;
        }
        .day-header {
            background-color: #f8f9fa;
            text-align: center;
            padding: 10px;
            border-bottom: 1px solid #ccc;
        }
        .time-slot {
            flex: 1;
            border-bottom: 1px solid #eee;
            padding: 5px;
            cursor: pointer;
            height: 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .time-label {
            font-size: 12px;
            color: #888;
            margin-right: 10px;
        }
        .entry-text {
            font-size: 12px;
            color: #000;
            text-align: right;
            flex: 1;
            margin-left: 10px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .time-slot:hover, .time-slot.selected {
            background-color: #d1e7dd;
        }
        .current-day {
            background-color: #ffd966 !important;
        }
        .hour-limit-container {
            padding: 10px;
            text-align: center;
        }
        .hour-limit-container label {
            font-size: 12px;
            margin-right: 5px;
        }
        .hour-limit-container select {
            padding: 5px;
            font-size: 12px;
            margin-bottom: 5px;
        }
        .hour-limit-container button {
            padding: 5px 10px;
            font-size: 12px;
            margin-left: 10px;
            cursor: pointer;
        }
        .input-container {
            margin-top: 20px;
            display: flex;
        }
        .input-fields {
            width: 60%;
        }
        .input-container input, .input-container textarea {
            width: 100%;
            padding: 5px;
            margin-bottom: 10px;
            box-sizing: border-box;
        }
        .input-container button {
            padding: 5px 10px;
            width: 100%;
            cursor: pointer;
        }
        .session-notes-container {
            width: 40%;
            margin-left: 20px;
        }
        .session-notes-box {
            width: 100%;
            height: 250px;
            padding: 10px;
            margin-top: 10px;
            border: 1px solid #ccc;
            overflow-y: auto;
            white-space: pre-wrap;
            background-color: #f9f9f9;
        }
        .save-load-container {
            margin-top: 20px;
            display: flex;
            justify-content: space-between;
        }
        .update-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: -10px;
            margin-bottom: 20px;
        }
        .update-buttons button {
            padding: 5px 10px;
            cursor: pointer;
        }
        .collapsed {
            display: none;
        }
    </style>
</head>
<body>

    <div class="video-container">
        <div class="large-video" id="largeVideo">
            <!-- Placeholder for large video conferencing screen -->
        </div>
        <div class="messaging-container">
            <div id="messageBox" class="message-box">
                <!-- Messages will appear here -->
            </div>
            <div class="message-input-container">
                <input type="text" id="messageInput" class="message-input" placeholder="Type a message...">
                <input type="file" id="fileInput" class="file-input">
                <button onclick="sendMessage()" class="send-button">Send</button>
            </div>
        </div>
    </div>

    <div class="calendar-container">
        <div class="month-year-header" onclick="toggleCalendar()">
            <h2 id="monthHeader"></h2>
            <span id="toggleArrow" class="arrow">▼</span>
        </div>
        <div>
            <select id="yearSelect" onchange="changeYear()"></select>
        </div>
    </div>

    <div id="weekCalendar" class="week-calendar"></div>

    <div class="input-container">
        <div class="input-fields">
            <input type="text" id="inputName" placeholder="Enter Name for the selected time slot">
            <button onclick="addText()">Add Name</button>
            <textarea id="sessionNotes" placeholder="Enter Session Notes"></textarea>
            <div class="update-buttons">
                <button onclick="updateSessionNotes()">Update Session Notes</button>
            </div>
            <textarea id="contactInfo" placeholder="Enter Contact Information"></textarea>
            <div class="update-buttons">
                <button onclick="updateContactInfo()">Update Contact Information</button>
            </div>
        </div>

        <div class="session-notes-container">
            <label for="sessionNotesBox"><strong>Session Notes</strong></label>
            <div id="sessionNotesBox" class="session-notes-box">
                <!-- Ongoing session notes will appear here -->
            </div>
        </div>
    </div>

    <div class="save-load-container">
        <button onclick="saveSchedule()">Save Schedule</button>
        <button onclick="loadEmptySchedule()">Load Empty Schedule</button>
        <input type="file" id="fileInput" style="display:none" onchange="loadSchedule(event)">
        <button onclick="document.getElementById('fileInput').click()">Load Another Schedule</button>
    </div>

    <script>
        const daysOfWeek = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
        let selectedDate = new Date();
        let currentDate = new Date();
        let selectedSlot = null;
        let scheduleData = {};
        let scheduleName = "schedule.json";
        let calendarCollapsed = false;

        function createCalendar() {
            const calendarElement = document.getElementById('weekCalendar');
            const monthHeaderElement = document.getElementById('monthHeader');
            calendarElement.innerHTML = '';

            const firstDayOfWeek = new Date(selectedDate);
            firstDayOfWeek.setDate(selectedDate.getDate() - selectedDate.getDay());

            const monthName = firstDayOfWeek.toLocaleString('default', { month: 'long' });
            monthHeaderElement.textContent = `${monthName} ${firstDayOfWeek.getFullYear()}`;

            for (let day = 0; day < 7; day++) {
                const currentDay = new Date(firstDayOfWeek);
                currentDay.setDate(firstDayOfWeek.getDate() + day);
                const currentDayKey = currentDay.toISOString().split('T')[0];

                const dayElement = document.createElement('div');
                dayElement.className = 'day';

                const dayHeaderElement = document.createElement('div');
                dayHeaderElement.className = 'day-header';
                dayHeaderElement.innerHTML = `<strong>${daysOfWeek[day]}</strong><br>${currentDay.getDate()}`;

                if (currentDay.toDateString() === currentDate.toDateString()) {
                    dayHeaderElement.classList.add('current-day');
                }

                dayElement.appendChild(dayHeaderElement);

                const startHour = 8;
                const endHour = 17;

                for (let hour = startHour; hour <= endHour; hour++) {
                    for (let half = 0; half < 2; half++) {
                        const timeSlotElement = document.createElement('div');
                        timeSlotElement.className = 'time-slot';
                        timeSlotElement.setAttribute('data-date', currentDayKey);
                        timeSlotElement.setAttribute('data-slot', hour * 2 + half);

                        const timeLabel = document.createElement('div');
                        timeLabel.className = 'time-label';
                        timeLabel.innerText = `${hour % 12 || 12}:${half === 0 ? '00' : '30'} ${hour >= 12 ? 'PM' : 'AM'}`;
                        timeSlotElement.appendChild(timeLabel);

                        const entryText = document.createElement('div');
                        entryText.className = 'entry-text';
                        const entry = scheduleData[`${currentDayKey}-${hour * 2 + half}`];
                        if (entry) {
                            entryText.innerText = entry.name;
                            timeSlotElement.setAttribute('data-notes', entry.notes || '');
                            timeSlotElement.setAttribute('data-contact', entry.contact || '');
                        }
                        timeSlotElement.appendChild(entryText);

                        timeSlotElement.onclick = () => selectSlot(timeSlotElement);
                        dayElement.appendChild(timeSlotElement);
                    }
                }

                calendarElement.appendChild(dayElement);
            }

            updateYearDropdown();
        }

        function toggleCalendar() {
            const calendarElement = document.getElementById('weekCalendar');
            const toggleArrow = document.getElementById('toggleArrow');
            calendarCollapsed = !calendarCollapsed;

            if (calendarCollapsed) {
                calendarElement.classList.add('collapsed');
                toggleArrow.textContent = '▲';
            } else {
                calendarElement.classList.remove('collapsed');
                toggleArrow.textContent = '▼';
            }
        }

        function selectSlot(element) {
            if (selectedSlot) {
                selectedSlot.classList.remove('selected');
            }
            selectedSlot = element;
            selectedSlot.classList.add('selected');

            const nameInput = document.getElementById('inputName');
            const notesInput = document.getElementById('sessionNotes');
            const contactInput = document.getElementById('contactInfo');
            const sessionNotesBox = document.getElementById('sessionNotesBox');

            nameInput.value = element.querySelector('.entry-text').innerText || '';
            notesInput.value = '';
            contactInput.value = element.getAttribute('data-contact') || '';
            sessionNotesBox.textContent = element.getAttribute('data-notes') || '';
        }

        function addText() {
            if (selectedSlot) {
                const name = document.getElementById('inputName').value;
                const notes = document.getElementById('sessionNotes').value;
                const contact = document.getElementById('contactInfo').value;

                // Check if the name already exists in the schedule
                for (const key in scheduleData) {
                    if (scheduleData[key].name === name) {
                        scheduleData[`${selectedSlot.getAttribute('data-date')}-${selectedSlot.getAttribute('data-slot')}`] = {
                            name: name,
                            notes: scheduleData[key].notes,
                            contact: scheduleData[key].contact
                        };
                        break;
                    }
                }

                if (!scheduleData[`${selectedSlot.getAttribute('data-date')}-${selectedSlot.getAttribute('data-slot')}`]) {
                    scheduleData[`${selectedSlot.getAttribute('data-date')}-${selectedSlot.getAttribute('data-slot')}`] = { name, notes, contact };
                }

                const entryText = selectedSlot.querySelector('.entry-text');
                entryText.innerText = name;
                selectedSlot.setAttribute('data-notes', notes);
                selectedSlot.setAttribute('data-contact', contact);

                // Automatically save and reload the schedule
                saveAndReloadSchedule();
            } else {
                alert('Please select a time slot.');
            }
        }

        function updateSessionNotes() {
            if (selectedSlot) {
                const currentDate = new Date().toLocaleString();
                const newNote = document.getElementById('sessionNotes').value.trim();
                
                if (newNote) {
                    const previousNotes = selectedSlot.getAttribute('data-notes') || '';
                    const updatedNotes = `${previousNotes}${previousNotes ? '\n' : ''}${currentDate}: ${newNote}`;

                    // Update the selected slot with the new notes
                    selectedSlot.setAttribute('data-notes', updatedNotes);

                    const name = document.getElementById('inputName').value;

                    // Update notes for all occurrences of the same name
                    for (const key in scheduleData) {
                        if (scheduleData[key].name === name) {
                            scheduleData[key].notes = updatedNotes;
                        }
                    }

                    // Update the session notes box with the latest notes
                    document.getElementById('sessionNotesBox').textContent = updatedNotes;

                    // Automatically save and reload the schedule
                    saveAndReloadSchedule();

                    // Clear the textarea after the note has been added
                    document.getElementById('sessionNotes').value = '';
                }
            } else {
                alert('Please select a time slot first.');
            }
        }

        function updateContactInfo() {
            if (selectedSlot) {
                const contact = document.getElementById('contactInfo').value;

                const name = document.getElementById('inputName').value;

                // Update contact info for all occurrences of the same name
                for (const key in scheduleData) {
                    if (scheduleData[key].name === name) {
                        scheduleData[key].contact = contact;
                    }
                }

                selectedSlot.setAttribute('data-contact', contact);

                // Automatically save and reload the schedule
                saveAndReloadSchedule();
            } else {
                alert('Please select a time slot first.');
            }
        }

        function saveAndReloadSchedule() {
            const timestamp = new Date().toISOString().replace(/[:.]/g, '-'); // Create a timestamp
            const newScheduleName = scheduleName.replace('.json', `_${timestamp}.json`);
            const fileContent = JSON.stringify(scheduleData);
            const blob = new Blob([fileContent], { type: "application/json" });
            const url = URL.createObjectURL(blob);

            // Create a temporary link to download the file
            const a = document.createElement('a');
            a.href = url;
            a.download = newScheduleName;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            // Automatically reload the schedule
            const file = new File([blob], newScheduleName, { type: "application/json" });
            const event = { target: { files: [file] } };
            loadSchedule(event);
        }

        function loadEmptySchedule() {
            const newScheduleName = prompt("Enter a name for your new schedule:", "new_schedule.json");
            if (newScheduleName) {
                scheduleName = newScheduleName;
                scheduleData = {};
                createCalendar();
                alert(`Empty schedule "${newScheduleName}" created.`);
            }
        }

        function nextWeek() {
            selectedDate.setDate(selectedDate.getDate() + 7);
            createCalendar();
        }

        function previousWeek() {
            selectedDate.setDate(selectedDate.getDate() - 7);
            createCalendar();
        }

        function updateYearDropdown() {
            const yearSelect = document.getElementById('yearSelect');
            const currentYear = selectedDate.getFullYear();
            yearSelect.innerHTML = '';

            for (let year = 2024; year <= 2034; year++) {
                const option = document.createElement('option');
                option.value = year;
                option.text = year;
                if (year === currentYear) {
                    option.selected = true;
                }
                yearSelect.appendChild(option);
            }
        }

        function changeYear() {
            const yearSelect = document.getElementById('yearSelect');
            selectedDate.setFullYear(yearSelect.value);
            createCalendar();
        }

        function goToToday() {
            selectedDate = new Date();
            createCalendar();
        }

        function saveSchedule() {
            const fileContent = JSON.stringify(scheduleData);
            const blob = new Blob([fileContent], { type: "application/json" });
            const url = URL.createObjectURL(blob);

            const a = document.createElement('a');
            a.href = url;
            a.download = scheduleName;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function loadSchedule(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    scheduleData = JSON.parse(e.target.result);
                    scheduleName = file.name;
                    createCalendar();
                };
                reader.readAsText(file);
            }
        }

        createCalendar();
    </script>

</body>
</html>
